= ansible-role-bootstrap
Jonas Pammer <opensource@jonaspammer.at>;
:toc:
:toclevels: 3
:toc-placement!:

ifdef::env-github[]
// https://gist.github.com/dcode/0cfbf2699a1fe9b46ff04c41721dda74#admonitions
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

// Very Relevant Status Badges
https://github.com/JonasPammer/ansible-role-bootstrap/actions/workflows/ci.yml[image:https://github.com/JonasPammer/ansible-role-bootstrap/actions/workflows/ci.yml/badge.svg[Testing CI]]
https://app.fossa.com/projects/git%2Bgithub.com%2FJonasPammer%2Fansible-role-bootstrap?ref=badge_shield[image:https://app.fossa.com/api/projects/git%2Bgithub.com%2FJonasPammer%2Fansible-role-bootstrap.svg?type=shield[FOSSA Status]]

// Badges about Conventions in this Project
https://conventionalcommits.org[image:https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg[Conventional Commits]]
https://results.pre-commit.ci/latest/github/JonasPammer/ansible-role-bootstrap/master[image:https://results.pre-commit.ci/badge/github/JonasPammer/ansible-role-bootstrap/master.svg[pre-commit.ci
status]]
// image:https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&logoColor=white[pre-commit, link=https://github.com/pre-commit/pre-commit]

https://open.vscode.dev/jonaspammer/ansible-role-bootstrap[image:https://img.shields.io/static/v1?logo=visualstudiocode&label=&message=Open%20in%20Visual%20Studio%20Code&labelColor=2c2c32&color=007acc&logoColor=007acc[Open in Visual Studio Code]]


An Ansible role for preparing a linux system to be managed by ansible.

This role uses the raw module (in combination with its own os-determination-system)
to install the minimum required set of packages (python and sudo) to allow Ansible to manage a system.

In most cases, you want to use this role in combination with the `ansible-core_dependencies`-role.


toc::[]

[[meta]]
== üîé Metadata
Below you can find information on‚Ä¶

* the role's required Ansible version
* the role's supported platforms
* the role's https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html#role-dependencies[role dependencies]

.link:meta/main.yml[]
[source,yaml]
----
include::meta/main.yml[]
----


[[requirements]]
== üìå Requirements
// Any prerequisites that may not be covered by this role or Ansible itself should be mentioned here.
User needs to be able to `become`



[[variables]]
== üìú Role Variables
// A description of the settable variables for this role should go here
// and any variables that can/should be set via parameters to the role.
// Any variables that are read from other roles and/or the global scope (ie. hostvars, group vars, etc.)
// should be mentioned here as well.

[source,yaml]
----
bootstrap_user: root
----
Username used to connect to the machine.

[source,yaml]
----
bootstrap_wait_for_host: false
----
Whether to wait for the host to be available on `ansible_port` (22).

[source,yaml]
----
bootstrap_timeout: 3
----
Maximum number of seconds to wait for the remote system to be reachable/usable before failing.


[[dependencies]]
== üë´ Dependencies
// A list of other roles should go here,
// plus any details in regard to parameters that may need to be set for other roles,
// or variables that are used from other roles.


[[example_playbooks]]
== üìö Example Playbook Usages
// Including examples of how to use this role in a playbook for common scenarios is always nice for users too:

[NOTE]
====
You must disable the `gather_facts`-property of the play this role is used in.
If this role finished successfully it'll call https://docs.ansible.com/ansible/latest/collections/ansible/builtin/setup_module.html[
ansible's setup module] itself (equivalent effect that `gather_facts: true` would give).

No tasks must come before this role.
====

.Minimum Viable Play
====
[source,yaml]
-----
---
- hosts: servers:&provisioned
  name: Bootstrap linux machines to be managed by Ansible.
  gather_facts: false

  roles:
    - role: jonaspammer.bootstrap
-----
====

.Preferred Play
====
[source,yaml]
-----
---
- hosts: servers:&provisioned
  name: Bootstrap linux machines to be managed by Ansible.
  gather_facts: false

  roles:
    - role: jonaspammer.bootstrap
    - role: jonaspammer.core_dependencies
-----
====


[[development]]
== üí™ Development

[[development--versioning]]
=== üì¶ Versioning

Versions are defined using https://git-scm.com/book/en/v2/Git-Basics-Tagging[Tags],
which in turn are https://galaxy.ansible.com/docs/contributing/version.html[recognized and used] by Ansible Galaxy.

When a new tag is pushed, https://github.com/JonasPammer/ansible-role-bootstrap/actions/workflows/release-to-galaxy.yml[
a GitHub CI workflow] takes care of importing the role to my Ansible Galaxy Account.
image:https://github.com/JonasPammer/ansible-role-bootstrap/actions/workflows/release-to-galaxy.yml/badge.svg[Release CI]

[[development--tips]]
=== üíÅ Tips

Take a look at my general ansible role development guidelines at .

[[cookiecutter]]
=== üç™ CookieCutter

This Project shall be kept in sync with
https://github.com/JonasPammer/cookiecutter-ansible-role[the CookieCutter it was originally templated from]
using https://github.com/cruft/cruft[cruft] (if possible) or manual alteration (if needed)
to the best extend possible.

.Official Example Usage of `cruft update`
____
image::https://raw.githubusercontent.com/cruft/cruft/master/art/example_update.gif[Official Example Usage of `cruft update`]
____

=== üßÉ Ideal, Containerized Development Environments

This Project offers definitions for 1-Click Containerized Development Environments through

* https://code.visualstudio.com/docs/remote/containers[
  Visual Studio Development Containers] (Local Docker Installation needed)
* https://www.gitpod.io/[Gitpod] (Cloud-Native Visual Studio Code PaaS)

These Containers even allow one to run docker containers inside of them (Docker-In-Docker, dind),
allowing for molecule execution.

[NOTE]
=====
You absolutely do not need to use it.
Your development environment can be whatever you want.

You don't even need to run tests on your local machine.
This Project uses the magic of CI/CD to automatically check your contributions' validness
(linting, most formatting, tests).
=====

==== Local Containerized Development Environment

The _Visual Studio Code Remote - Containers_ extension lets one use a Docker container
as a full-featured development environment.

This Project offers such a devcontainer definition.
By looking at its docker-compose and dockerfile definition,
one may inform himself about everything there is to know about
how to setup the ideal development environment,
*even if you do not use this editor in combination with this feature*
(Code as Documentation).

To use it:

1. Install https://code.visualstudio.com/[Visual Studio Code].
2. Click on the following badge (which is even linked at the top of most of my projects) and press "Clone repo in container volume": https://open.vscode.dev/jonaspammer/ansible-role-bootstrap[image:https://img.shields.io/static/v1?logo=visualstudiocode&label=&message=Open%20in%20Visual%20Studio%20Code&labelColor=2c2c32&color=007acc&logoColor=007acc[Open in Visual Studio Code]]

[NOTE]
=====
You may need to...

* Install and configure https://www.docker.com/get-started[Docker] for your operating system.


* Install the https://aka.ms/vscode-remote/download/extension[Remote Development extension pack.]

, even though modern VSCode offers to automatically do all that too
by just clicking a button that pops up (crazy).
=====

[NOTE]
=====
You may need to configure your host system to enable the container to use your SSH Keys.

The procedure is described https://code.visualstudio.com/docs/remote/containers#_sharing-git-credentials-with-your-container[
in the official devcontainer docs under "Sharing Git credentials with your container"].
=====

[TIP]
====
The "Open in Visual Studio Code" badge even got other fancy options worth checking out, especially for non-relevant Ad-Hoc On-The-Go changes, being
"Open with Remote Repositories" or
"Open in VS Code for the Web".
====

[TIP]
====
Once you've opened a folder in a container, any terminal window you open in VS Code (Terminal > New Terminal) will automatically run in the container rather than locally.
====

==== Gitpod Containerized Development Environment

__It's basically like what you would get by clicking on "Open in VS Code for the Web",
with the exception that there's an actual machine running docker somewhere for you,
so you basically got *all* the features --
but also with all the benefits of a pre-defined, Containerized Development Environment.
It even has a free plan.
It's great for Ad-Hoc changes / fiddling around from anywhere on any kind of Computer Device I'm on right now.
Big Baller's can even Self-Host the service.__

https://gitpod.io/#https://github.com/JonasPammer/ansible-role-bootstrap[image:https://gitpod.io/button/open-in-gitpod.svg[Open in Gitpod]]


== üí™ Contributing
include::CONTRIBUTING.adoc[]


[[changelog]]
== üìù Changelog
include::CHANGELOG.adoc[]


== ‚öñÔ∏è License

.link:LICENSE[]
----
include::LICENSE[]
----

https://app.fossa.com/projects/git%2Bgithub.com%2FJonasPammer%2Fansible-role-bootstrap?ref=badge_large[image:https://app.fossa.com/api/projects/git%2Bgithub.com%2FJonasPammer%2Fansible-role-bootstrap.svg?type=large[FOSSA Status]]
